/*!
 * PjaxRouter
 * https://github.com/yomotsu/PjaxRouter
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PjaxRouter=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){var e=t.target;this.triggers.some(function(t){return e.matches(t)})&&(!l.test(e.href)||(t.preventDefault(),this.url!==e.href&&this.load(e.href)))}function i(t){t.state&&this.load(t.state.url,!0)}var o=document.createElement("html"),n=new XMLHttpRequest,s=function(t,e){n.open("GET",t,!0),n.timeout=5e3,n.onload=function(){o.innerHTML=n.responseText.replace(/^(.+)?<html(.+)?>/gi,""),e(o)},n.ontimeout=function(){e(null)},n.onerror=function(){e(null)},n.send(null)},r=function(){function o(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,o),o.supported&&(this.lastStartTime=-1,this.url=location.href,this.triggers=n.triggers,this.selectors=n.selectors,this.switches=n.switches,this._listeners=[],this._onLinkClick=e.bind(this),this._onPopstate=i.bind(this),window.history.replaceState({url:window.location.href,scrollTop:document.body.scrollTop||document.documentElement.scrollTop},document.title),document.body.addEventListener("click",this._onLinkClick),window.addEventListener("popstate",this._onPopstate))}return o.prototype.pageTransition=function(t,e){var i=this;this.lastStartTime===e&&(this.dispatch({type:"load"}),this.dispatch({type:"beforeswitch"}),this.selectors.forEach(function(e){var o=document.querySelector(e),n=t.querySelector(e);"function"==typeof i.switches[e]&&i.switches[e](o,n)}),this.dispatch({type:"afterswitch"}))},o.prototype.load=function(t,e){var i=this;this.dispatch({type:"beforeload"});var o=Date.now();this.url=t,this.lastStartTime=o,s(this.url,function(t){if(!t)return i.dispatch({type:"error"}),void(location.href=i.url);if(!e){var n=t.querySelector("title").textContent,s={url:i.url,scrollTop:document.body.scrollTop||document.documentElement.scrollTop};history.pushState(s,n,i.url)}i.pageTransition(t,o)})},o.prototype.on=function(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].indexOf(e)===-1&&this._listeners[t].push(e)},o.prototype.off=function(t,e){var i=this._listeners[t];if(i){var o=i.indexOf(e);o!==-1&&i.splice(o,1)}},o.prototype.dispatch=function(t){var e=this._listeners[t.type];if(e){t.target=this;for(var i=e.length,o=0;o<i;o++)e[o].call(this,t)}},o}();r.supported=window.history&&window.history.pushState;var l=new RegExp(location.origin);return r});
