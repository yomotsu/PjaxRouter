/*!
 * PjaxRouter
 * https://github.com/yomotsu/PjaxRouter
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PjaxRouter=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){var e=t.target;this.triggers.some(function(t){return e.matches(t)})&&(!a.test(e.href)||(t.preventDefault(),this.url!==e.href&&this.load(e.href)))}function i(t){t.state&&this.load(t.state.url,!0)}var n=document.createElement("html"),s=new XMLHttpRequest;s.timeout=2e3;var o=function(t,e){s.open("GET",t,!0),s.onload=function(){n.innerHTML=s.responseText.replace(/^(.+)?<html(.+)?>/gi,""),e(n)},s.ontimeout=function(){e(null)},s.onerror=function(){e(null)},s.send(null)},r=function(){function n(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,n),this.lastStartTime=-1,this.url=location.href,this.triggers=s.triggers,this.selectors=s.selectors,this.switches=s.switches,this._listeners=[],this._onLinkClick=e.bind(this),this._onPopstate=i.bind(this),window.history.replaceState({url:window.location.href},document.title),document.body.addEventListener("click",this._onLinkClick),window.addEventListener("popstate",this._onPopstate)}return n.prototype.pageTransition=function(t,e){var i=this;this.lastStartTime===e&&(this.dispatch({type:"load"}),this.dispatch({type:"beforeswitch"}),this.selectors.forEach(function(e){var n=document.querySelector(e),s=t.querySelector(e);i.switches[e](n,s)}),this.dispatch({type:"afterswitch"}))},n.prototype.load=function(t,e){var i=this;this.dispatch({type:"beforeload"});var n=Date.now();this.url=t,this.lastStartTime=n,o(this.url,function(t){if(!t)return i.dispatch({type:"error"}),void(location.href=i.url);if(!e){var s=t.querySelector("title").textContent,o={url:i.url};history.pushState(o,s,i.url)}i.pageTransition(t,n)})},n.prototype.on=function(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].indexOf(e)===-1&&this._listeners[t].push(e)},n.prototype.off=function(t,e){var i=this._listeners[t];if(i){var n=i.indexOf(e);n!==-1&&i.splice(n,1)}},n.prototype.dispatch=function(t){var e=this._listeners[t.type];if(e){t.target=this;for(var i=e.length,n=0;n<i;n++)e[n].call(this,t)}},n}(),a=new RegExp(location.origin);return r});
