/*!
 * PjaxRouter
 * https://github.com/yomotsu/PjaxRouter
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PjaxRouter=e()}(this,function(){"use strict";function t(t,e){return l.call(t,e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(e){var o=e.target,i=this.triggers.some(function(e){return t(o,e)}),n=this.ignores.some(function(e){return t(o,e)}),s=!h.test(o.href);!i||n||s||(e.preventDefault(),this.url!==o.href&&this.load(o.href))}function i(t){t.state&&this.load(t.state.url,!0)}var n=document.createElement("html"),s=new XMLHttpRequest,r=function(t,e){s.open("GET",t,!0),s.timeout=5e3,s.onload=function(){n.innerHTML=s.responseText.replace(/^(.+)?<html(.+)?>/gi,""),e(n)},s.ontimeout=function(){e(null)},s.onerror=function(){e(null)},s.send(null)},l=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector,c=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,t),t.supported&&(this.lastStartTime=-1,this.url=location.href,this.triggers=n.triggers,this.ignores=n.ignores||[],this.selectors=n.selectors,this.switches=n.switches,this._listeners=[],this._onLinkClick=o.bind(this),this._onPopstate=i.bind(this),window.history.replaceState({url:window.location.href,scrollTop:document.body.scrollTop||document.documentElement.scrollTop},document.title),document.body.addEventListener("click",this._onLinkClick),window.addEventListener("popstate",this._onPopstate))}return t.prototype.pageTransition=function(t,e){var o=this;this.lastStartTime===e&&(this.dispatch({type:"load"}),this.dispatch({type:"beforeswitch"}),this.selectors.forEach(function(e){var i=document.querySelector(e),n=t.querySelector(e);"function"==typeof o.switches[e]&&o.switches[e](n,i)}),this.dispatch({type:"afterswitch"}))},t.prototype.load=function(t,e){var o=this;this.dispatch({type:"beforeload"});var i=Date.now();this.url=t,this.lastStartTime=i,r(this.url,function(t){if(!t)return o.dispatch({type:"error"}),void(location.href=o.url);if(!e){var n=t.querySelector("title").textContent,s={url:o.url,scrollTop:document.body.scrollTop||document.documentElement.scrollTop};history.pushState(s,n,o.url)}o.pageTransition(t,i)})},t.prototype.on=function(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].indexOf(e)===-1&&this._listeners[t].push(e)},t.prototype.off=function(t,e){var o=this._listeners[t];if(o){var i=o.indexOf(e);i!==-1&&o.splice(i,1)}},t.prototype.dispatch=function(t){var e=this._listeners[t.type];if(e){t.target=this;for(var o=e.length,i=0;i<o;i++)e[i].call(this,t)}},t}();c.supported=window.history&&window.history.pushState;var h=new RegExp(location.origin);return c});
