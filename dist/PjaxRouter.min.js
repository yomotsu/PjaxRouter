!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PjaxRouter=e()}(this,function(){"use strict";function t(t,e){return i.call(t,e)}function e(e,o){for(;e&&e.nodeType!==r;){if(t(e,o))return e;e=e.parentNode}}var o=document.createElement("html"),n=new XMLHttpRequest,i=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector,r=9,s=function(){function t(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t.supported&&(this.lastStartTime=-1,this.url=location.href,this.triggers=o.triggers,this.ignores=o.ignores||[],this.selectors=o.selectors,this.switches=o.switches,this._listeners={},this._onLinkClick=function(t){var o=void 0,n=this.triggers.some(function(n){return!!(o=e(t.target,n))}),i=this.ignores.some(function(o){return!!e(t.target,o)});n&&!i&&(!c.test(o.href)||(t.preventDefault(),this.url!==o.href&&this.load(o.href)))}.bind(this),this._onPopstate=function(t){t.state&&this.load(t.state.url,!0)}.bind(this),window.history.replaceState({url:window.location.href,scrollTop:document.body.scrollTop||document.documentElement.scrollTop},document.title),document.body.addEventListener("click",this._onLinkClick),window.addEventListener("popstate",this._onPopstate))}return t.prototype.pageTransition=function(t,e){var o=this;this.lastStartTime===e&&(this.dispatch("load"),this.dispatch("beforeswitch"),this.selectors.forEach(function(e){var n=document.querySelector(e),i=t.querySelector(e);"function"==typeof o.switches[e]&&o.switches[e](i,n)}),this.dispatch("afterswitch"))},t.prototype.load=function(t,e){var i=this;this.dispatch("beforeload");var r=Date.now();this.url=t,this.lastStartTime=r,function(t,e){n.open("GET",t,!0),n.timeout=5e3,n.onload=function(){o.innerHTML=n.responseText.replace(/^(.+)?<html(.+)?>/gi,""),e(o)},n.ontimeout=function(){e(null)},n.onerror=function(){e(null)},n.send(null)}(this.url,function(t){if(!t)return i.dispatch("error"),void(location.href=i.url);if(!e){var o=t.querySelector("title").textContent,n={url:i.url,scrollTop:document.body.scrollTop||document.documentElement.scrollTop};history.pushState(n,o,i.url)}i.pageTransition(t,r)})},t.prototype.on=function(t,e){this._listeners[t]||(this._listeners[t]=[]),-1===this._listeners[t].indexOf(e)&&this._listeners[t].push(e)},t.prototype.once=function(t,e){var o=this;this.on(t,function n(){e(),o.off(t,n)})},t.prototype.off=function(t,e){var o=this._listeners[t];if(o){var n=o.indexOf(e);-1!==n&&o.splice(n,1)}},t.prototype.dispatch=function(t){var e=this._listeners[t];if(e)for(var o=e.length,n=0;n<o;n++)e[n].call(this)},t}();s.supported=window.history&&window.history.pushState;var c=new RegExp(location.origin);return s});
