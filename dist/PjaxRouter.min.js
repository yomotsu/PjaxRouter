!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PjaxRouter=e()}(this,function(){"use strict";function t(t,e){return i.call(t,e)}function e(e,o){for(;e&&e.nodeType!==r;){if(t(e,o))return e;e=e.parentNode}}var o=document.createElement("html"),n=new XMLHttpRequest,i=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector,r=9,s=function(){function t(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t.supported&&(this.lastStartTime=-1,this.url=location.href,this.triggers=o.triggers,this.ignores=o.ignores||[],this.selectors=o.selectors,this.switches=o.switches,this._listeners={},this._onLinkClick=function(t){var o=void 0,n=this.triggers.some(function(n){return!!(o=e(t.target,n))}),i=this.ignores.some(function(o){return!!e(t.target,o)});n&&!i&&(!l.test(o.href)||(t.preventDefault(),this.url!==o.href&&this.load(o.href)))}.bind(this),this._onPopstate=function(t){t.state&&this.load(t.state.url,!0)}.bind(this),window.history.replaceState({url:window.location.href,scrollTop:document.body.scrollTop||document.documentElement.scrollTop},document.title),document.body.addEventListener("click",this._onLinkClick),window.addEventListener("popstate",this._onPopstate))}return t.prototype.pageTransition=function(t){var e=this;this.emit("beforeswitch"),this.selectors.forEach(function(o){var n=document.querySelector(o),i=t.querySelector(o);"function"==typeof e.switches[o]&&e.switches[o](i,n)}),this.emit("afterswitch")},t.prototype.load=function(t,e){var i=this;this.emit("beforeload");var r=Date.now();this.url=t,this.lastStartTime=r,function(t,e,i){var r=Date.now();n.open("GET",t,!0),n.timeout=5e3,n.onload=function(t){o.innerHTML=n.responseText.replace(/^(.+)?<html(.+)?>/gi,""),e(o,{loaded:t.loaded,total:t.total,elapsedTime:Date.now()-r})},n.ontimeout=function(){e(null)},n.onerror=function(){e(null)},n.onprogress=function(t){i({loaded:t.loaded,total:t.total,elapsedTime:Date.now()-r})},n.send(null)}(this.url,function(t,o){if(!t)return i.emit("error"),void(location.href=i.url);if(!e){var n=t.querySelector("title").textContent,s={url:i.url,scrollTop:document.body.scrollTop||document.documentElement.scrollTop};history.pushState(s,n,i.url)}i.lastStartTime===r&&(i.emit("load",o),i.pageTransition(t))},function(t){i.emit("loading",t)})},t.prototype.on=function(t,e,o){this._listeners[t]||(this._listeners[t]=[]);var n={callback:e,once:o&&o.once||!1};this._listeners[t].some(function(t){return t.listener===e})||this._listeners[t].push(n)},t.prototype.once=function(t,e){this.on(t,e,{once:!0})},t.prototype.off=function(t,e){if(this._listeners[t])if(e){for(var o=this._listeners[t],n=0,i=o.length;n<i;n+=1)if(o[n].callback===e)return void o.splice(n,1)}else delete this._listeners[t]},t.prototype.emit=function(t,e){var o=this,n=this._listeners[t];n&&(this._listeners[t]=n.filter(function(t){return t.callback.call(o,e),!t.once}))},t}();s.supported=window.history&&window.history.pushState;var l=new RegExp(location.origin);return s});
