/*!
 * PjaxRouter v2.0.0
 * https://github.com/yomotsu/PjaxRouter
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).PjaxRouter=e()}(this,function(){"use strict";class t{constructor(e){this.lastStartTime=-1,this._listeners={},t.supported&&(this.url=location.href,this.timeout=e.timeout||5e3,this.triggers=e.triggers||[],this.ignores=e.ignores||[],this.selectors=e.selectors,this.switches=e.switches,this._onLinkClick=t=>this.onLinkClick(t),this._onPopstate=t=>this.onPopstate(t),window.history.replaceState({url:window.location.href,scrollTop:document.body.scrollTop||document.documentElement.scrollTop},document.title),document.body.addEventListener("click",this._onLinkClick),window.addEventListener("popstate",this._onPopstate))}pageTransition(t){this.emit("beforeswitch"),this.selectors.forEach(e=>{const s=document.querySelector(e),o=t.querySelector(e);s&&o&&"function"==typeof this.switches[e]&&this.switches[e].call(this,o,s)}),this.emit("afterswitch")}async load(t,e=!1){this.emit("beforeload",{nextUrl:t});const s=Date.now();this.url=t,this.lastStartTime=s;try{const t=await async function(t,e,s=5e3){var o;const i=Date.now(),r=new AbortController,n=setTimeout(()=>r.abort(),s);try{const s=await fetch(t,{signal:r.signal});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const l=null===(o=s.body)||void 0===o?void 0:o.getReader(),a=parseInt(s.headers.get("Content-Length")||"0",10);if(!l){const t=await s.text();return clearTimeout(n),{text:t,progress:{loaded:t.length,total:t.length,elapsedTime:Date.now()-i}}}let c=0;const h=[];for(;;){const{done:t,value:s}=await l.read();if(t)break;h.push(s),c+=s.length,e&&e({loaded:c,total:a||c,elapsedTime:Date.now()-i})}clearTimeout(n);const u=new Blob(h);return{text:await u.text(),progress:{loaded:c,total:a||c,elapsedTime:Date.now()-i}}}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw new Error("Request timeout");throw t}}(this.url,t=>this.emit("loading",t),this.timeout),o=(new DOMParser).parseFromString(t.text,"text/html");if(!e){const t=o.querySelector("title"),e=t?t.innerHTML:this.url,s={url:this.url,scrollTop:document.body.scrollTop||document.documentElement.scrollTop};history.pushState(s,e,this.url)}if(this.lastStartTime!==s)return;this.emit("load",t.progress),this.pageTransition(o)}catch(t){this.emit("error",t),location.href=this.url}}on(t,e,s){this._listeners[t]||(this._listeners[t]=[]);const o={callback:e,once:(null==s?void 0:s.once)||!1};this._listeners[t].some(t=>t.callback===e)||this._listeners[t].push(o)}once(t,e){this.on(t,e,{once:!0})}off(t,e){if(!this._listeners[t])return;if(!e)return void delete this._listeners[t];const s=this._listeners[t],o=s.findIndex(t=>t.callback===e);-1!==o&&s.splice(o,1)}emit(t,e){const s=this._listeners[t];s&&(this._listeners[t]=s.filter(t=>(t.callback.call(this,e),!t.once)))}onLinkClick(t){const e=new RegExp(location.origin);let s=null;const o=this.triggers.some(e=>{const o=t.target.closest(e);return!!o&&(s=o,!0)}),i=this.ignores.some(e=>!!t.target.closest(e));if(!o||i||!s)return;const r=s;!e.test(r.href)||(t.preventDefault(),this.url!==r.href&&this.load(r.href))}onPopstate(t){if(!t.state)return;const e=t.state;this.load(e.url,!0)}}return t.supported=!(!window.history||!window.history.pushState),t});
//# sourceMappingURL=PjaxRouter.min.js.map
