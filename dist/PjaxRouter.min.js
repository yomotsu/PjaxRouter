/*!
 * PjaxRouter
 * https://github.com/yomotsu/PjaxRouter
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PjaxRouter=e()}(this,function(){"use strict";function t(t,e){return l.call(t,e)}function e(e,o){for(;e&&e.nodeType!==a;){if(t(e,o))return e;e=e.parentNode}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){var o=void 0,i=this.triggers.some(function(i){return!!(o=e(t.target,i))}),n=this.ignores.some(function(o){return!!e(t.target,o)});if(i&&!n){!u.test(o.href)||(t.preventDefault(),this.url!==o.href&&this.load(o.href))}}function n(t){t.state&&this.load(t.state.url,!0)}var r=document.createElement("html"),s=new XMLHttpRequest,c=function(t,e){s.open("GET",t,!0),s.timeout=5e3,s.onload=function(){r.innerHTML=s.responseText.replace(/^(.+)?<html(.+)?>/gi,""),e(r)},s.ontimeout=function(){e(null)},s.onerror=function(){e(null)},s.send(null)},l=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector,a=9,h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t),t.supported&&(this.lastStartTime=-1,this.url=location.href,this.triggers=e.triggers,this.ignores=e.ignores||[],this.selectors=e.selectors,this.switches=e.switches,this._listeners=[],this._onLinkClick=i.bind(this),this._onPopstate=n.bind(this),window.history.replaceState({url:window.location.href,scrollTop:document.body.scrollTop||document.documentElement.scrollTop},document.title),document.body.addEventListener("click",this._onLinkClick),window.addEventListener("popstate",this._onPopstate))}return t.prototype.pageTransition=function(t,e){var o=this;this.lastStartTime===e&&(this.dispatch({type:"load"}),this.dispatch({type:"beforeswitch"}),this.selectors.forEach(function(e){var i=document.querySelector(e),n=t.querySelector(e);"function"==typeof o.switches[e]&&o.switches[e](n,i)}),this.dispatch({type:"afterswitch"}))},t.prototype.load=function(t,e){var o=this;this.dispatch({type:"beforeload"});var i=Date.now();this.url=t,this.lastStartTime=i,c(this.url,function(t){if(!t)return o.dispatch({type:"error"}),void(location.href=o.url);if(!e){var n=t.querySelector("title").textContent,r={url:o.url,scrollTop:document.body.scrollTop||document.documentElement.scrollTop};history.pushState(r,n,o.url)}o.pageTransition(t,i)})},t.prototype.on=function(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].indexOf(e)===-1&&this._listeners[t].push(e)},t.prototype.off=function(t,e){var o=this._listeners[t];if(o){var i=o.indexOf(e);i!==-1&&o.splice(i,1)}},t.prototype.dispatch=function(t){var e=this._listeners[t.type];if(e){t.target=this;for(var o=e.length,i=0;i<o;i++)e[i].call(this,t)}},t}();h.supported=window.history&&window.history.pushState;var u=new RegExp(location.origin);return h});
